
# VASP 拟合 E-V 曲线

在复杂体系的结构优化中，由于局域最小能量的影响，弛豫得到的 CONTCAR 不一定是全局最低能量的结构。
Birch-Murnaghan (BM) 方程为我们提供了一种拟合内能函数 U(V) 的方法，通过极值条件可以确定平衡晶体的体积或晶格常数（参考：黄昆《固体物理》P53）。

## 具体流程

1. **初始设置**: 在 POSCAR 文件中使用 Direct 坐标，修改第 2 行的缩放因子以改变晶胞体积，生成一系列固定体积的结构。
2. **结构优化**: 设置 `ISIF = 2`，对生成的 POSCAR 文件逐一进行结构优化（弛豫），得到新的 CONTCAR 文件。
3. **单点计算**: 将弛豫后的 CONTCAR 复制为新的 POSCAR，设置单点计算以获取总能量。
4. **BM 方程拟合**: 将总能量和体积数据拟合到 BM 方程，得到平衡状态下的晶格参数。

初始设置可以参考下面这个脚本 `EV_test.sh`：

```sh
# Usage: ./EV_test.sh

for i in 0.90 0.91 0.92 0.93 0.94 0.95 0.96 0.97 0.98 0.99 1.00 1.01 1.02 1.03 1.04 1.05 1.06 1.07 1.08 1.09 1.10
do
  if [ -d $i ]
  then
    rm -r $i
  fi
  mkdir $i
  cp POSCAR $i
  sed -i "2s/1.0/$i/g" $i/POSCAR
done
```

### 注意事项

- POSCAR 第二行的缩放系数若为负值，该值表示晶胞体积，而非线性缩放比例。
- VASP 的单点计算忽略了温度对原子的激发效应，因此得到的晶格常数是 0 K 下的结果。

---

## 有限温度下的晶格常数计算

要获得有限温度下的晶格常数，可选择以下方法：

1. **Phonopy 的 QHA 模块**:
   通过准谐近似（Quasi-Harmonic Approximation, QHA）计算温度对晶格常数的修正。
   
2. **AIMD 模拟**:
   在 NPT 系综下进行分子动力学模拟，设置 `ISMEAR = -1`，选择合适的 SIGMA 值以匹配电子温度。
   - 模拟时间应足够长（通常 10 ps 以上）。
   - 确保体系在模拟过程中维持晶体结构。
   - 统计模拟轨迹中的晶格常数的时间平均值。

3. **温度相关的 DFT 计算**:
   直接进行依赖于温度的第一性原理计算。

> 一般情况下，室温（约 300 K）和 0 K 下的晶格常数差异通常小于 0.5%，因此 DFT 的基态计算结果已能很好解释实验现象。但在高温或高压条件下，需特别考虑温度效应。

---

## 高压下的晶格常数计算

- **设置压强**: 在 INCAR 文件中添加 `PSTRESS = 100`（单位为 kbar，10 GPa = 100 kbar），其他参数保持不变。
- **焓计算**: 此时 OSZICAR 文件中的 E0 和 F 值包含了压强体积项的贡献，即 \( E0 = U + pV \)（焓，Enthalpy，符号 H）。

### 高压弛豫建议

直接将 0 GPa 平衡结构用于 300 GPa 的弛豫可能失败，可通过以下方法解决：

1. **逐步加压**:
   依次在 50 GPa、100 GPa 等压力下优化，逐步逼近目标压强。

2. **晶格缩放**:
   修改 POSCAR 第二行的缩放因子，例如将 1 修改为 0.9（等比例压缩晶胞），使初始结构更接近目标压强下的晶格常数。然后设置 `PSTRESS = 3000`（对应 300 GPa）进行弛豫。

通过上述方法，可更高效地获得不同压强下的晶格常数及其相关物性。
