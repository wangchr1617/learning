
# VASP 弹性常数计算

弹性模量完全由内能函数 U(V) 决定，例如体变模量
$$
K = (V(d^{2}U)/(dV^{2}))_{V_{0}}
$$
通常采用标准原胞或标准单胞计算弹性常数。
首先需要执行高精度结构优化，将优化后的 CONTCAR 拷贝成 POSCAR ，并准备好 INCAR、KPOINTS 和 POTCAR 。

## 有限位移法

INCAR 的参考设置如下：

```
ISTART = 0
ICHARG = 2
LCHARG = .F.
LWAVE = .F.

ALGO = Normal
NELM = 120
EDIFF = 1E-08		# 有限差分法要求提高收敛精度

ISIF = 3			# 弹性常数计算时 ISIF >= 3
IBRION = 6			# 这里 5 表示振动频率计算，6 表示弹性常数计算
NSW = 1				# 只进行一步离子弛豫
NFREE = 4			# 这里 2 和 4 都可以，它们的差距很小
POTIM = 0.015		# 在 IBRION = 5 / 6 时，POTIM 决定离子移动的步长，单位为埃

ENCUT = 800			# 计算弹性常数时一般需要较高的平面波截断能
ISMEAR = 0
SIGMA = 0.05
PREC = Accurate
LREAL = .False.
ADDGRID = .TRUE.
```

由于计算弹性常数时对 K 点密度要求较高，使用 `vaspkit 102` 生成 KPOINTS 时 K-mesh 应该小于等于 0.03 。
注意，不要设置 `NPAR`、`NCORE` 等并行参数，否则会报错。

计算完成后，弹性常数矩阵会直接写入 OUTCAR。
可以使用命令 `grep -A9 'TOTAL ELASTIC MODULI' OUTCAR` 查看弹性刚度矩阵（注意单位 $kBar = 0.1 GPa$）。
对不同的晶系的晶体，因为对称性的关系，弹性刚度矩阵中独立的弹性常数是确定的。
因此，晶系的对称性越高，独立的张量元数目越少。

利用 `vaspkit 203` 可以直接得到弹性常数和机械性能。
得到弹性常数后，体积弹性模量剪切模量和杨氏模量的估计值是 Voigh-Reuss-Hill（VRH）的平均值，维氏硬度是用 Chen-Niu 模型计算得到的，而断裂韧性是基于 Niu-Niu-Oganov 模型计算得到的。

注意 OUTCAR中输出的刚度矩阵（弹性常数矩阵）通常是针对三维块体材料的原始数据，未经过针对二维材料的特殊处理。
二维材料的力学性质需消除 z 方向（垂直平面）的应力-应变耦合，通常需通过​​平面应力条件​​修正或单位转换。更推荐使用下面介绍的能量-应变法计算弹性常数。

---

## 能量-应变法 / 应力-应变法

INCAR 的参考设置如下：
```
SYSTEM = GeTe

ISTART = 0
ICHARG = 2
LCHARG = .F.
LWAVE = .F.
ISYM = 2

ALGO = Normal
NELM = 120
NELMIN = 4
EDIFF = 1E-08

ISIF = 2
IBRION = 2
NSW = 100
EDIFFG = -1E-02
POTIM = 0.1

ENCUT = 600
ISMEAR = 0
SIGMA = 0.05
PREC = A
LREAL = F
ADDGRID = .T.
```

准备 VPKIT.in 文件：
```
1 # 设置 1 将产生计算弹性常数的输入文件，2 则计算弹性常数
3D # 设置 2D 即为二维体系，3D 为三维体系
7 # 应变数目，对应下一行的变化范围
-0.015 -0.010 -0.005 0.000 0.005 0.010 0.015 # 应变变化范围
```

使用 `vaspkit-200`（应力-应变）或 `vaspkit-201`（能量-应变）生成用于计算弹性常数的文件，并批量提交所有子文件夹下的任务。

计算完成后，修改 VPKIT.in 中第一行为 2 ，输出弹性常数矩阵等信息。

如果在计算弹性常数时希望强制固定某个体系的空间群，可在 SYMMETRY.in 文件的第二行设置空间群，这样晶系将通过指定空间群判断并计算相应的独立弹性常数，对于掺杂或合金体系非常有用。

在同样目标精度的条件下，能量-应变法相比应力-应变法要求的截断能（ENCUT）和 K 点数目相对较少，但前者计算应变数目有所增加。